<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Staff Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">
    <div class="w-full max-w-4xl bg-white shadow-md rounded-lg p-6">
      <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">
        Staff Management
      </h1>

      <!-- Form for Adding Staff -->
      <div class="mb-8">
        <h2 class="text-xl font-semibold text-gray-700 mb-4">Add New Staff</h2>
        <form id="staffForm" enctype="multipart/form-data" class="space-y-4">
          <div>
            <label for="name" class="block text-sm font-medium text-gray-600"
              >Name</label
            >
            <input
              type="text"
              id="name"
              name="name"
              class="w-full p-2 border rounded-md"
              placeholder="Enter name"
              required
            />
          </div>
          <div>
            <label for="email" class="block text-sm font-medium text-gray-600"
              >Email</label
            >
            <input
              type="email"
              id="email"
              name="email"
              class="w-full p-2 border rounded-md"
              placeholder="Enter email"
              required
            />
          </div>
          <div>
            <label for="phone" class="block text-sm font-medium text-gray-600"
              >Phone</label
            >
            <input
              type="text"
              id="phone"
              name="phone"
              class="w-full p-2 border rounded-md"
              placeholder="Enter phone (e.g., +1234567890)"
            />
          </div>
          <div>
            <label for="role" class="block text-sm font-medium text-gray-600"
              >Role</label
            >
            <select id="role" name="role" class="w-full p-2 border rounded-md">
              <option value="staff">Staff</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div>
            <label for="image" class="block text-sm font-medium text-gray-600"
              >Profile Image</label
            >
            <input
              type="file"
              id="image"
              name="image"
              accept="image/*"
              class="w-full p-2 border rounded-md"
            />
          </div>
          <button
            type="submit"
            class="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700"
          >
            Add Staff
          </button>
        </form>
      </div>

      <!-- Staff List -->
      <div>
        <h2 class="text-xl font-semibold text-gray-700 mb-4">Staff List</h2>
        <div id="staffList" class="space-y-4"></div>
      </div>
    </div>

    <script>
      const API_URL = "http://localhost:5000/api/staff";

      // Handle add staff form submission
      document
        .getElementById("staffForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);

          try {
            const response = await fetch(API_URL, {
              method: "POST",
              body: formData,
            });
            const data = await response.json();

            if (!response.ok) throw new Error(data.message || "Unknown error");

            alert("Staff added successfully!");
            e.target.reset();
            fetchStaff();
          } catch (error) {
            console.error("Error adding staff:", error);
            alert("Error adding staff: " + error.message);
          }
        });

      // Fetch and display all staff
      async function fetchStaff() {
        try {
          const response = await fetch(API_URL);
          if (!response.ok) throw new Error("Failed to fetch staff");
          const data = await response.json();
          const staff = data.data.staff || [];

          const staffList = document.getElementById("staffList");
          staffList.innerHTML = "";

          if (staff.length === 0) {
            staffList.innerHTML =
              '<p class="text-gray-500">No staff found.</p>';
            return;
          }

          staff.forEach((s) => {
            const div = document.createElement("div");
            div.className =
              "border p-4 rounded-md flex justify-between items-start";
            div.innerHTML = `
                        <div>
                            <p><strong>Name:</strong> ${s.name}</p>
                            <p><strong>Email:</strong> ${s.email}</p>
                            <p><strong>Phone:</strong> ${s.phone || "N/A"}</p>
                            <p><strong>Role:</strong> ${s.role}</p>
                            <p><strong>Image:</strong> ${
                              s.imageUrl
                                ? `<img src="${s.imageUrl}" alt="${s.name}" class="w-24 h-24 object-cover rounded-md" />`
                                : "N/A"
                            }</p>
                            <p><strong>Created At:</strong> ${new Date(
                              s.createdAt
                            ).toLocaleString()}</p>
                        </div>
                        <div class="space-x-2">
                            <button onclick="editStaff('${
                              s._id
                            }')" class="bg-yellow-500 text-white px-3 py-1 rounded-md hover:bg-yellow-600">Edit</button>
                            <button onclick="deleteStaff('${
                              s._id
                            }')" class="bg-red-500 text-white px-3 py-1 rounded-md hover:bg-red-600">Delete</button>
                        </div>
                    `;
            staffList.appendChild(div);
          });
        } catch (error) {
          console.error("Error fetching staff:", error);
          document.getElementById("staffList").innerHTML =
            '<p class="text-red-500">Error fetching staff.</p>';
        }
      }

      // Edit staff
      async function editStaff(id) {
        try {
          const response = await fetch(`${API_URL}/${id}`);
          if (!response.ok) throw new Error("Failed to fetch staff");
          const {
            data: { staff },
          } = await response.json();

          const form = document.getElementById("staffForm");
          form.name.value = staff.name;
          form.email.value = staff.email;
          form.phone.value = staff.phone || "";
          form.role.value = staff.role;
          form.image.value = "";

          form.onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);

            try {
              const response = await fetch(`${API_URL}/${id}`, {
                method: "PUT",
                body: formData,
              });
              if (!response.ok)
                throw new Error(
                  `Failed to update staff: ${response.statusText}`
                );
              alert("Staff updated successfully!");
              e.target.reset();
              e.target.onsubmit = addStaff; // Reset to add mode
              fetchStaff();
            } catch (error) {
              console.error("Error updating staff:", error);
              alert("Error updating staff: " + error.message);
            }
          };
        } catch (error) {
          console.error("Error fetching staff for edit:", error);
          alert("Error: " + error.message);
        }
      }

      // Delete staff
      async function deleteStaff(id) {
        if (!confirm("Are you sure you want to delete this staff member?"))
          return;
        try {
          const response = await fetch(`${API_URL}/${id}`, {
            method: "DELETE",
          });
          if (!response.ok) throw new Error("Failed to delete staff");
          alert("Staff deleted successfully!");
          fetchStaff();
        } catch (error) {
          console.error("Error deleting staff:", error);
          alert("Error deleting staff: " + error.message);
        }
      }

      const addStaff = document.getElementById("staffForm").onsubmit;

      window.onload = fetchStaff;
    </script>
  </body>
</html>
